type Etudiant @model @auth(rules: [
  { allow: owner, ownerField: "owner", operations: [create, read, update] },
  { allow: public, operations: [create] }
   { allow: groups, groups: ["Operateurs"], operations: [read] }

]) {
  id: ID!
  nom: String!
  prenom: String!
  apogee: String! @index(name: "byApogee", queryField: "etudiantByApogee")
  cin: String!
  cycle: Cycle! @index(name: "byCycle", queryField: "etudiantByCycle")
  email: AWSEmail! @index(name: "byEmail", queryField: "etudiantByEmail")
  owner: String
  filiereId: ID! @index(name: "byFiliereEtudiant", queryField: "etudiantByFiliere")
  filiere: Filiere @belongsTo(fields: ["filiereId"])
  absences: [Absence] @hasMany(indexName: "byEtudiantAbsence", fields: ["id"])
  attestationsInscription: [AttestationInscription] @hasMany(indexName: "byEtudiant", fields: ["id"])
  annulationInscription: [AnnulationInscription] @hasMany(indexName: "byEtudiant", fields: ["id"])
 ajoutModule: [AjoutModule] @hasMany(indexName: "byEtudiant", fields: ["id"])
 anomalies: [Anomalies] @hasMany(indexName: "byEtudiant", fields: ["id"])

}

type Absence @model @auth(rules: [
  { allow: owner, ownerField: "owner", operations: [create, read, update, delete] },
  { allow: groups, groups: ["Operateurs"], operations: [read, update] }
]) {
  id: ID!

  etudiantId: ID! @index(name: "byEtudiantAbsence")
  etudiant: Etudiant @belongsTo(fields: ["etudiantId"])

  status: Status!
  dateAbsence: AWSDateTime
  justificationUrl: AWSURL
  module: String
  commentaire: String

  createdAt: AWSDateTime
  updatedAt: AWSDateTime
}

type AttestationInscription @model @auth(rules: [
  { allow: owner, ownerField: "owner", operations: [create, read, update, delete] },
  { allow: groups, groups: ["Operateurs"], operations: [read, update] }
]) {
  id: ID!

  etudiantId: ID! @index(name: "byEtudiant")
  etudiant: Etudiant @belongsTo(fields: ["etudiantId"])
  status: Status!
}

type AnnulationInscription @model @auth(rules: [
  { allow: owner, ownerField: "owner", operations: [create, read, update, delete] },
  { allow: groups, groups: ["Operateurs"], operations: [read, update] }
]) {
  id: ID!
  etudiantId: ID! @index(name: "byEtudiant")
  etudiant: Etudiant @belongsTo(fields: ["etudiantId"])
  status: Status!
}

type Anomalies @model @auth(rules: [
  { allow: owner, ownerField: "owner", operations: [create, read, update, delete] },
  { allow: groups, groups: ["Operateurs"], operations: [read, update] }
]) {
  id: ID!
  etudiantId: ID! @index(name: "byEtudiant")
  etudiant: Etudiant @belongsTo(fields: ["etudiantId"])
  anomalie: Anomalie!
  description: String 
  status: Status!

}



type AjoutModule @model @auth(rules: [
  { allow: owner, ownerField: "owner", operations: [create, read, update, delete] },
  { allow: groups, groups: ["Operateurs"], operations: [read, update] }
]) {
  id: ID!
  etudiantId: ID! @index(name: "byEtudiant")
  etudiant: Etudiant @belongsTo(fields: ["etudiantId"])
  module: Int!
  semestre: String!
  status: Status!
}



type Filiere @model @auth(rules: [
  { allow: public, operations: [create, read, update, delete] },
  { allow: private, operations: [read] },
  { allow: owner, operations: [create, read, update] }
]) {
  id: ID!
  nomFiliere: NomFiliere! @index(name: "byNomFiliere", queryField: "nomFiliere")
  operateur: Operateur @hasOne(fields: ["id"])
  etudiants: [Etudiant] @hasMany(fields: ["id"])
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
}

type Operateur @model @auth(rules: [
  { allow: groups, groups: ["Operateurs"], operations: [read, create, update] }
]) {
  id: ID!
  nom: String!
  prenom: String!
  email: AWSEmail! @index(name: "byEmail", queryField: "operateurByEmail")
  filiereId: ID! @index(name: "byFiliereOperateur")
  filiere: Filiere @belongsTo(fields: ["filiereId"])
}


enum NomFiliere {
  BIOLOGIE
  PHYSIQUE
  CHIMIE
  MATH
  INFORMATIQUE
}

enum Cycle {
  LICENCE
  MASTER
}

enum Status {
  REFUS
  ENCOURS
  ACCEPTE
}

enum Anomalie {
INSCRIPTION
AFFICHAGE_ENT
CALENDRIER_EXAMEN
}

